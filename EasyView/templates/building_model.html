{% extends 'base_layout.html' %}
{% load static %}
{% block title %}{{ model.building.kks }}{% endblock %}
{% block content %}
    <div id="viewer_settings"
         {% block viewpoint_data %}
         model_pk="{{ model.pk }}"
         {% endblock %}
         api_url="{{ api_url }}"
    >
    <script type="module" src="{% static 'EasyView/js/main.js' %}"></script>
    </div>

    <!--Sidebar with notes-->
    <aside id="viewpointsMenu" class="sidebar">
    <div class="list-group">
      <!--Expandable list of view point buttons-->
      <button type="button" class="list-group-item list-group-item-action" data-bs-toggle="collapse" data-bs-target="#remarkButtons-collapse">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-right" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"></path></svg>
        <span class="text-muted m-2 ms-4">Замечания</span>
      </button>
      <div class="collapse" id="remarkButtons-collapse">
        <div id="remarkButtons" class="list-group">
        <!--Insertion point for remark buttons-->
        </div>
      </div>
      <!--Expandable list of view point buttons-->
      <button type="button" class="list-group-item list-group-item-action" data-bs-toggle="collapse" data-bs-target="#pointButtons-collapse">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-right" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"></path></svg>
        <span class="text-muted m-2 ms-4">Точки&nbsp;обзора</span>
      </button>
      <div class="collapse" id="pointButtons-collapse">
        <div id="pointButtons" class="list-group">
        <!--Insertion point for viewpoint buttons-->
        </div>
      </div>
    </div>
    </aside>

    <!--Button to toggle sidebar with notes-->
    <div id="btnPlacer" class="button-placer">
    <button id="viewpointsMenuToggleButton">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-right rotateOnHalf" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"></path></svg>
    </button>
    </div>

    <!--Camera button-->
    <button id="camera" class="float-action-button bg-primary">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-camera" viewBox="0 0 16 16"><path d="M15 12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h1.172a3 3 0 0 0 2.12-.879l.83-.828A1 1 0 0 1 6.827 3h2.344a1 1 0 0 1 .707.293l.828.828A3 3 0 0 0 12.828 5H14a1 1 0 0 1 1 1v6zM2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4H2z"></path><path d="M8 11a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5zm0 1a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7zM3 6.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0z"></path></svg>
    </button>

    <!--Toasts wrapper-->
    <div class="toast-placer toast-container position-absolute w-100 p-3 d-flex flex-column align-items-center bottom-0">

    <!--Toast to show viewpoint deletion notification-->
    <div id="viewPointDeletionToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="toast-header bg-danger">
        <img src="{% static 'icons/trash.svg' %}" class="rounded me-2" alt="NoteIcon">
        <strong class="me-auto text-white">Удалено</strong>
        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
      <div class="toast-body">
        <p>Точка обзора была успешно удалена</p>
      </div>
    </div>

    <!--Toast to show notifications-->
    <div id="viewPointToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="toast-header bg-success">
        <img src="{% static 'icons/camera.svg' %}" class="rounded me-2" alt="CameraImage">
        <strong class="me-auto text-white">Точка обзора сохранена</strong>
        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
      <div class="toast-body">
        Ссылка на точку обзора скопирована в буфер обмена
      </div>
    </div>

    <!--Toast to show description of a viewpoint-->
    <div id="viewPointDescriptionToast"
         class="toast"
         data-bs-delay="50000"
         role="alert"
         aria-live="assertive"
         aria-atomic="true">
      <div class="toast-header bg-info">
        <img src="{% static 'icons/card-text.svg' %}" class="rounded me-2" alt="NoteIcon">
        <strong class="me-auto text-white">Описание</strong>
        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
      <div class="toast-body">
        <p id="descriptionText"></p>
      </div>
    </div>

    </div>

    <!--Modal to provide interface to viewpoint saving-->
    <div class="modal fade"
         id="viewPointModal"
         data-bs-backdrop="static"
         data-bs-keyboard="false"
         tabindex="-1"
         aria-labelledby="viewPointModalLabel"
         aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="viewPointModalLabel">Новая точка обзора</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрыть"></button>
          </div>
          <div class="modal-body">

            <div id="notesInsideModal">
              <button id="note" class="btn btn-primary m-1">Добавить заметку</button>
            </div>

            <div class="form-floating mb-3 mt-3">
              <input type="text"
                     class="form-control"
                     id="descriptionInput"
                     placeholder="Ваша вентиляционная труба проходит через реактор">
              <label for="descriptionInput">Описание точки</label>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" id="cancelViewPoint" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
            <button type="button" id="saveViewPoint" class="btn btn-primary" data-bs-dismiss="modal">Сохранить</button>
          </div>
        </div>
      </div>
    </div>

    <!--Modal to provide interface of notes saving-->
    <div class="modal fade"
         id="noteModal"
         data-bs-backdrop="static"
         data-bs-keyboard="false"
         tabindex="-1"
         aria-labelledby="noteModalLabel"
         aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="noteModalLabel">Новая заметка</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрыть"></button>
          </div>
          <div class="modal-body">
            <div class="form-floating mb-3">
              <input type="text"
                     class="form-control"
                     id="noteTextInput"
                     placeholder="Текст">
              <label for="noteTextInput">Текст заметки</label>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" id="cancelNoteButton" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
            <button type="button" id="saveNote" class="btn btn-primary disabled" data-bs-dismiss="modal">Указать точку</button>
          </div>
        </div>
      </div>
    </div>

    <!--Loading screen that disappears after model loading-->
    <section id="loading-screen">
	<div id="loader"></div>
    </section>

{% endblock %}